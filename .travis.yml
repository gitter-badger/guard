language: java

sudo: false

cache:
  directories:
    - $HOME/.m2
    - $HOME/.sonar

addons:
  sonarcloud:
    organization: "demkada"

jdk:
  - openjdk8

jobs:
  include:
    - stage: Build
      script:  mvn -B clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar

    - stage: Release
      if: branch = master AND env(RELEASE_VERSION) IS present AND env(DEV_VERSION) IS present AND type != push AND type != pull_request
      script:  git checkout "$TRAVIS_BRANCH" && mvn -B -Prelease -DskipTests=true release:clean release:prepare release:perform --settings settings.xml
